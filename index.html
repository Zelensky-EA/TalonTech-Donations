<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalonTech Invoice System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --ea-navy: #13294b; --ea-gold: #C5B783; --ea-white: #FFFFFF; }
        body { background-color: var(--ea-navy); color: var(--ea-white); font-family: sans-serif; }
        .card { background-color: rgba(255, 255, 255, 0.05); border: 2px solid var(--ea-gold); }
        .accent-text { color: var(--ea-gold); }
        input, select { background-color: #1e3a5f !important; color: white !important; border: 1px solid #334155 !important; }
        .result-box { background-color: var(--ea-gold); color: var(--ea-navy); }
        .btn-submit { background-color: #10b981; transition: transform 0.1s; }
        .btn-submit:active { transform: scale(0.98); }
    </style>
</head>
<body class="p-4 flex flex-col items-center min-h-screen">

    <div id="app-card" class="max-w-md w-full card rounded-2xl shadow-2xl p-6 my-4">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-black accent-text uppercase tracking-wider">TalonTech Club</h1>
            <p class="text-sm font-bold opacity-90 mt-1 uppercase">Everett Alvarez High School</p>
            <div class="h-1 w-24 bg-white mx-auto mt-2 rounded-full"></div>
        </header>

        <div class="space-y-4 mb-6 pb-6 border-b border-slate-700">
            <div>
                <label class="block text-xs font-bold uppercase mb-1 accent-text tracking-widest">Student Name</label>
                <input type="text" id="studentName" placeholder="First & Last Name" class="w-full p-3 rounded-lg outline-none">
            </div>
            <div>
                <label class="block text-xs font-bold uppercase mb-1 accent-text tracking-widest">Project Name</label>
                <input type="text" id="projectName" placeholder="e.g. Mechanical Gear" class="w-full p-3 rounded-lg outline-none">
            </div>
        </div>

        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold uppercase mb-1 accent-text">Filament (grams)</label>
                    <input type="number" id="grams" placeholder="0" class="w-full p-3 rounded-lg outline-none" oninput="calc()">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase mb-1 accent-text">Print Time</label>
                    <select id="time" class="w-full p-3 rounded-lg outline-none" onchange="calc()">
                        <option value="1">< 1hr ($1)</option>
                        <option value="3">1-3hr ($3)</option>
                        <option value="6.5">3-6hr ($6.50)</option>
                        <option value="10">6-12hr ($10)</option>
                        <option value="15">12-24hr ($15)</option>
                        <option value="25">24hr+ ($25)</option>
                    </select>
                </div>
            </div>
            <div>
                <label class="block text-xs font-bold uppercase mb-1 accent-text">Design & Support Level</label>
                <select id="support" class="w-full p-3 rounded-lg outline-none" onchange="calc()">
                    <option value="1">Personal Design + Light Support ($1)</option>
                    <option value="2">Online Design + Normal Support ($2)</option>
                    <option value="6">Major/Heavy Support ($6)</option>
                    <option value="10">Complex/Internal Release ($10)</option>
                    <option value="15">Full Assembly/Finishing ($15)</option>
                </select>
            </div>
        </div>

        <div class="mt-8 p-6 result-box rounded-xl text-center shadow-lg">
            <p class="text-xs font-bold uppercase tracking-widest opacity-80">Suggested Donation</p>
            <h2 id="totalDisplay" class="text-5xl font-black mt-1">$3.00</h2>
        </div>

        <button onclick="submitInvoice()" class="w-full mt-6 py-4 rounded-xl text-sm font-bold uppercase tracking-widest btn-submit text-white shadow-lg">
            Submit & Download PDF
        </button>

        <p class="text-[11px] text-center mt-6 text-slate-400 italic">
            Note: Donations help cover filament & maintenance for the club.
        </p>
    </div>

    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(submitted){showSuccess();}"></iframe>

    <script>
        let submitted = false;
        window.jsPDF = window.jspdf.jsPDF;

        function calc() {
            const grams = parseFloat(document.getElementById('grams').value) || 0;
            const timeVal = parseFloat(document.getElementById('time').value);
            const supportVal = parseFloat(document.getElementById('support').value);
            
            // Formula: Support/Design + Time + (Grams * $0.05/gram)
            let total = supportVal + timeVal + (grams * 0.05);
            
            if (total < 3) total = 3; // Minimum donation rule
            
            const totalStr = total.toFixed(2);
            document.getElementById('totalDisplay').innerText = `$${totalStr}`;
            return totalStr;
        }

        function submitInvoice() {
            const name = document.getElementById('studentName').value;
            const project = document.getElementById('projectName').value;
            const total = calc();

            if(!name || !project) {
                alert("Please enter both the Student Name and Project Name.");
                return;
            }

            // Using your specific Google Form IDs
            const formID = "1FAIpQLSekNv5fJmGCELXyxyHY4ImsaVjtcpg43m3n2T0wKDpg1LB7FQ";
            const nameEntry = "entry.1416729802";
            const projectEntry = "entry.465402565";
            const donationEntry = "entry.58770648";

            const baseURL = `https://docs.google.com/forms/d/e/${formID}/formResponse`;
            const submitURL = `${baseURL}?${nameEntry}=${encodeURIComponent(name)}&${projectEntry}=${encodeURIComponent(project)}&${donationEntry}=${total}&submit=Submit`;

            submitted = true;
            document.getElementById('hidden_iframe').src = submitURL;
            
            generatePDF(name, project, total);
        }

        function generatePDF(name, project, total) {
            const doc = new jsPDF();
            const date = new Date().toLocaleDateString();

            // Header styling
            doc.setFillColor(19, 41, 75); // Navy
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text("TALONTECH CLUB INVOICE", 20, 25);

            // Body
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text(`Date: ${date}`, 20, 55);
            doc.text(`Student: ${name}`, 20, 65);
            doc.text(`Project: ${project}`, 20, 75);
            
            doc.setDrawColor(197, 183, 131); // Gold line
            doc.setLineWidth(1);
            doc.line(20, 85, 190, 85);

            doc.setFontSize(18);
            doc.text(`SUGGESTED DONATION: $${total}`, 20, 105);

            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text("Printing is free. This suggested donation helps cover materials.", 20, 125);
            doc.text("Thank you for supporting the TalonTech Club at Everett Alvarez!", 20, 132);

            doc.save(`TalonTech_Invoice_${name.replace(/\s+/g, '_')}.pdf`);
        }

        function showSuccess() {
            document.getElementById('app-card').innerHTML = `
                <div class="text-center py-10">
                    <div class="text-6xl mb-4">âœ…</div>
                    <h2 class="text-3xl font-black accent-text uppercase">Submitted!</h2>
                    <p class="mt-4 px-4 text-slate-300">Data recorded in club logs and PDF downloaded.</p>
                    <button onclick="location.reload()" class="mt-8 px-8 py-3 bg-blue-900 border-2 border-gold accent-text rounded-xl font-bold uppercase tracking-widest">
                        New Print Job
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
